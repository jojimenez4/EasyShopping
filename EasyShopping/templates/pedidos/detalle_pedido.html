{% extends "../base.html" %}
{% block content %}
<div class="content-section">
    <h1 class="mb-4">Detalle del Pedido</h1>

    <div class="mb-4">
        <h4>Informaci√≥n del Pedido</h4>
        <p><strong>ID:</strong> {{ pedido.id }}</p>
        <p><strong>Contacto:</strong>
            {% if pedido.id_contacto %}
                {{ pedido.id_contacto.nombre_comprador }}
            {% else %}
                Sin contacto
            {% endif %}
        </p>
        <p><strong>Fecha:</strong> {{ pedido.fecha_venta|date:"d/m/Y H:i" }}</p>
        <p><strong>Estado:</strong> {{ pedido.estado_pedido }}</p>
    </div>

    <div class="mb-4">
        <h4>Cambiar Estado del Pedido</h4>
        <form method="post" action="{% url 'cambiar_estado_pedido' id=pedido.id %}">
            {% csrf_token %}
            <div class="form-group">
                <label for="estado_pedido">Nuevo Estado</label>
                <select id="estado_pedido" name="estado_pedido" class="form-control">
                    {% for key, value in pedido.ESTADO_CHOICES %}
                        <option value="{{ key }}" {% if key == pedido.estado_pedido %}selected{% endif %}>
                            {{ value }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <button type="submit" class="btn btn-primary mt-2">Cambiar Estado</button>
        </form>
    </div>

    <div class="mb-4">
        <h4>Detalles del Pedido</h4>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Producto</th>
                    <th>Cantidad</th>
                    <th>Precio Unitario</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody>
                {% for detalle in detalles %}
                    <tr>
                        <td>{{ detalle.id_product.name }}</td>
                        <td>{{ detalle.cantidad }}</td>
                        <td>${{ detalle.precio_unitario }}</td>
                        <td>${{ detalle.total }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <a href="{% url 'pedidos' %}" class="btn btn-secondary">Volver a Pedidos</a>
</div>
{% endblock %}
